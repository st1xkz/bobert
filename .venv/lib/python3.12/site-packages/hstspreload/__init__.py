"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.8.1"
__checksum__ = "0e7e2e20ef1b4beba1c22caeba8c7065a6563175a680bde47b852a254b73abf3"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'fujitsu', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 10), (1257, 23), (1280, 18), (1298, 18), None, (1316, 20), (1336, 26), (1362, 27), (1389, 28), (1417, 20), (1437, 59), (1496, 14), (1510, 14), (1524, 8), (1532, 8), (1540, 10), (1550, 13), (1563, 20), (1583, 19), None, (1602, 13), (1615, 26), (1641, 11), (1652, 4), (1656, 22), (1678, 19), (1697, 21), (1718, 14), (1732, 28), (1760, 11), (1771, 10), (1781, 12), (1793, 25), None, (1818, 19), (1837, 14), (1851, 26), (1877, 45), (1922, 15), None, (1937, 11), (1948, 30), (1978, 21), (1999, 26), (2025, 6), (2031, 6), (2037, 14), (2051, 5), (2056, 30), (2086, 23), (2109, 6), (2115, 17), (2132, 8), (2140, 12), (2152, 12), (2164, 70), (2234, 55), (2289, 12), (2301, 23), (2324, 16), (2340, 29), (2369, 9), (2378, 24), (2402, 44), (2446, 6), (2452, 41), (2493, 22), (2515, 23), (2538, 31), (2569, 20), (2589, 8), (2597, 15), (2612, 12), (2624, 32), (2656, 25), (2681, 15), None, (2696, 46), (2742, 21), (2763, 17), (2780, 18), (2798, 26), (2824, 5), (2829, 37), (2866, 39), (2905, 16), (2921, 33), (2954, 17), (2971, 23), (2994, 21), (3015, 25), (3040, 8), (3048, 14), (3062, 7), (3069, 37), None, (3106, 18), (3124, 21), (3145, 20), (3165, 17), (3182, 24), (3206, 12), (3218, 36), (3254, 35), (3289, 12), (3301, 57), (3358, 25), (3383, 32), None, (3415, 8), (3423, 25), (3448, 18), (3466, 6), (3472, 23), None, (3495, 36), (3531, 33), (3564, 14), (3578, 16), (3594, 22), None, (3616, 30), (3646, 41), (3687, 50), (3737, 15), (3752, 20), (3772, 31), (3803, 21), (3824, 32), (3856, 24), (3880, 20), (3900, 17), (3917, 52), (3969, 6), (3975, 9), (3984, 12), (3996, 18), (4014, 11), (4025, 10), (4035, 39), (4074, 42), None, (4116, 36), (4152, 17), None, (4169, 8), (4177, 8), (4185, 17), None, (4202, 25), (4227, 17), None, (4244, 21), (4265, 35), (4300, 21), (4321, 10), (4331, 48), (4379, 11), (4390, 37), (4427, 41), (4468, 19), (4487, 12), (4499, 14), (4513, 23), (4536, 29), (4565, 14), (4579, 8), (4587, 47), (4634, 52), None, None, (4686, 47), (4733, 42), None, (4775, 18), None, (4793, 15), (4808, 8), (4816, 21), (4837, 6), (4843, 29), (4872, 22)], [(4894, 8589), (13483, 8234), (21717, 8910), (30627, 8621), (39248, 8283), (47531, 8484), (56015, 8954), (64969, 8184), (73153, 8344), (81497, 8024), (89521, 8639), (98160, 7807), (105967, 8412), (114379, 9300), (123679, 8469), (132148, 9220), (141368, 9287), (150655, 7864), (158519, 8699), (167218, 7666), (174884, 8764), (183648, 8202), (191850, 8465), (200315, 8944), (209259, 8752), (218011, 8233), (226244, 8822), (235066, 9640), (244706, 8127), (252833, 8195), (261028, 8892), (269920, 8487), (278407, 8634), (287041, 8775), (295816, 8210), (304026, 8863), (312889, 8735), (321624, 9313), (330937, 8787), (339724, 8771), (348495, 8981), (357476, 7794), (365270, 8430), (373700, 8298), (381998, 8102), (390100, 8700), (398800, 8114), (406914, 9769), (416683, 8249), (424932, 7938), (432870, 8450), (441320, 8161), (449481, 8473), (457954, 8524), (466478, 8202), (474680, 8557), (483237, 8482), (491719, 8868), (500587, 8535), (509122, 7493), (516615, 7903), (524518, 8783), (533301, 8612), (541913, 8926), (550839, 9362), (560201, 8121), (568322, 8420), (576742, 8994), (585736, 9364), (595100, 8247), (603347, 7958), (611305, 8048), (619353, 7758), (627111, 9048), (636159, 8119), (644278, 8836), (653114, 8132), (661246, 9382), (670628, 8534), (679162, 8468), (687630, 8390), (696020, 7795), (703815, 8302), (712117, 8633), (720750, 8504), (729254, 8796), (738050, 9144), (747194, 8280), (755474, 7779), (763253, 8442), (771695, 9777), (781472, 8621), (790093, 8060), (798153, 8519), (806672, 8414), (815086, 8461), (823547, 8611), (832158, 7800), (839958, 8570), (848528, 7833), (856361, 8300), (864661, 8071), (872732, 8384), (881116, 8015), (889131, 8216), (897347, 9196), (906543, 8735), (915278, 8891), (924169, 8152), (932321, 8267), (940588, 9179), (949767, 8482), (958249, 7847), (966096, 7946), (974042, 8412), (982454, 8422), (990876, 8649), (999525, 8887), (1008412, 8495), (1016907, 8395), (1025302, 8673), (1033975, 8531), (1042506, 8107), (1050613, 8565), (1059178, 8938), (1068116, 8094), (1076210, 8267), (1084477, 9227), (1093704, 8185), (1101889, 9554), (1111443, 9336), (1120779, 8519), (1129298, 8047), (1137345, 7708), (1145053, 8130), (1153183, 9151), (1162334, 9254), (1171588, 9616), (1181204, 8795), (1189999, 8925), (1198924, 9384), (1208308, 8832), (1217140, 8446), (1225586, 8654), (1234240, 9344), (1243584, 7614), (1251198, 8614), (1259812, 8231), (1268043, 8383), (1276426, 8382), (1284808, 8425), (1293233, 8664), (1301897, 8518), (1310415, 7940), (1318355, 8215), (1326570, 8667), (1335237, 8656), (1343893, 8600), (1352493, 8104), (1360597, 7939), (1368536, 8089), (1376625, 8520), (1385145, 8545), (1393690, 8221), (1401911, 8671), (1410582, 9228), (1419810, 9548), (1429358, 8008), (1437366, 9626), (1446992, 8506), (1455498, 8342), (1463840, 8440), (1472280, 9162), (1481442, 8095), (1489537, 8177), (1497714, 8477), (1506191, 8921), (1515112, 9031), (1524143, 8088), (1532231, 7853), (1540084, 10469), (1550553, 9138), (1559691, 8017), (1567708, 8328), (1576036, 8756), (1584792, 8865), (1593657, 7816), (1601473, 9206), (1610679, 8335), (1619014, 8601), (1627615, 8472), (1636087, 8121), (1644208, 8370), (1652578, 7627), (1660205, 8424), (1668629, 7766), (1676395, 7700), (1684095, 8072), (1692167, 8287), (1700454, 8942), (1709396, 8587), (1717983, 8617), (1726600, 8898), (1735498, 7669), (1743167, 8896), (1752063, 9092), (1761155, 7952), (1769107, 8710), (1777817, 9496), (1787313, 8039), (1795352, 9289), (1804641, 8732), (1813373, 8141), (1821514, 8432), (1829946, 8703), (1838649, 8577), (1847226, 8303), (1855529, 8550), (1864079, 8437), (1872516, 9162), (1881678, 8343), (1890021, 7872), (1897893, 8983), (1906876, 8458), (1915334, 8634), (1923968, 8309), (1932277, 9272), (1941549, 8902), (1950451, 8763), (1959214, 9245), (1968459, 9173), (1977632, 8482), (1986114, 8306), (1994420, 8816), (2003236, 8350), (2011586, 9294), (2020880, 8485), (2029365, 7871), (2037236, 7884), (2045120, 8932), (2054052, 9050), (2063102, 8716), (2071818, 8703), (2080521, 8788), (2089309, 8118), (2097427, 9210), (2106637, 8608), (2115245, 8384), (2123629, 8616), (2132245, 7653), (2139898, 8448), (2148346, 8538), (2156884, 8254), (2165138, 8100), (2173238, 8325), (2181563, 8781)], [(2190344, 910), (2191254, 798), (2192052, 862), (2192914, 810), (2193724, 915), (2194639, 786), (2195425, 638), (2196063, 926), (2196989, 664), (2197653, 882), (2198535, 454), (2198989, 656), (2199645, 908), (2200553, 1036), (2201589, 833), (2202422, 667), (2203089, 1280), (2204369, 755), (2205124, 769), (2205893, 848), (2206741, 1174), (2207915, 764), (2208679, 791), (2209470, 728), (2210198, 755), (2210953, 786), (2211739, 924), (2212663, 1350), (2214013, 760), (2214773, 760), (2215533, 811), (2216344, 745), (2217089, 759), (2217848, 800), (2218648, 1039), (2219687, 1047), (2220734, 561), (2221295, 820), (2222115, 766), (2222881, 951), (2223832, 812), (2224644, 761), (2225405, 697), (2226102, 822), (2226924, 776), (2227700, 839), (2228539, 689), (2229228, 790), (2230018, 781), (2230799, 585), (2231384, 740), (2232124, 787), (2232911, 820), (2233731, 847), (2234578, 1315), (2235893, 704), (2236597, 862), (2237459, 770), (2238229, 607), (2238836, 758), (2239594, 837), (2240431, 841), (2241272, 993), (2242265, 849), (2243114, 715), (2243829, 789), (2244618, 943), (2245561, 701), (2246262, 614), (2246876, 1039), (2247915, 823), (2248738, 710), (2249448, 433), (2249881, 777), (2250658, 431), (2251089, 781), (2251870, 641), (2252511, 939), (2253450, 901), (2254351, 618), (2254969, 847), (2255816, 832), (2256648, 944), (2257592, 758), (2258350, 914), (2259264, 867), (2260131, 758), (2260889, 606), (2261495, 889), (2262384, 944), (2263328, 1130), (2264458, 1157), (2265615, 985), (2266600, 775), (2267375, 712), (2268087, 569), (2268656, 990), (2269646, 815), (2270461, 774), (2271235, 747), (2271982, 813), (2272795, 818), (2273613, 794), (2274407, 548), (2274955, 799), (2275754, 952), (2276706, 652), (2277358, 571), (2277929, 812), (2278741, 974), (2279715, 811), (2280526, 1007), (2281533, 1064), (2282597, 724), (2283321, 687), (2284008, 737), (2284745, 759), (2285504, 908), (2286412, 659), (2287071, 736), (2287807, 1136), (2288943, 759), (2289702, 918), (2290620, 803), (2291423, 891), (2292314, 768), (2293082, 876), (2293958, 855), (2294813, 618), (2295431, 943), (2296374, 686), (2297060, 968), (2298028, 739), (2298767, 704), (2299471, 631), (2300102, 945), (2301047, 905), (2301952, 702), (2302654, 642), (2303296, 841), (2304137, 802), (2304939, 716), (2305655, 672), (2306327, 660), (2306987, 783), (2307770, 623), (2308393, 817), (2309210, 655), (2309865, 832), (2310697, 627), (2311324, 822), (2312146, 641), (2312787, 811), (2313598, 911), (2314509, 1031), (2315540, 863), (2316403, 822), (2317225, 1032), (2318257, 892), (2319149, 763), (2319912, 1007), (2320919, 746), (2321665, 919), (2322584, 919), (2323503, 1067), (2324570, 1116), (2325686, 659), (2326345, 934), (2327279, 729), (2328008, 679), (2328687, 752), (2329439, 499), (2329938, 1152), (2331090, 639), (2331729, 1010), (2332739, 868), (2333607, 976), (2334583, 821), (2335404, 630), (2336034, 745), (2336779, 1915), (2338694, 834), (2339528, 802), (2340330, 829), (2341159, 1018), (2342177, 652), (2342829, 915), (2343744, 941), (2344685, 614), (2345299, 965), (2346264, 667), (2346931, 606), (2347537, 562), (2348099, 1154), (2349253, 755), (2350008, 754), (2350762, 709), (2351471, 714), (2352185, 982), (2353167, 917), (2354084, 859), (2354943, 793), (2355736, 876), (2356612, 683), (2357295, 685), (2357980, 679), (2358659, 733), (2359392, 1031), (2360423, 891), (2361314, 774), (2362088, 770), (2362858, 743), (2363601, 852), (2364453, 1122), (2365575, 553), (2366128, 825), (2366953, 798), (2367751, 791), (2368542, 719), (2369261, 627), (2369888, 653), (2370541, 847), (2371388, 831), (2372219, 1029), (2373248, 585), (2373833, 664), (2374497, 775), (2375272, 721), (2375993, 756), (2376749, 804), (2377553, 963), (2378516, 535), (2379051, 1056), (2380107, 683), (2380790, 707), (2381497, 792), (2382289, 899), (2383188, 574), (2383762, 866), (2384628, 894), (2385522, 855), (2386377, 528), (2386905, 870), (2387775, 576), (2388351, 936), (2389287, 557), (2389844, 768), (2390612, 871), (2391483, 663), (2392146, 924), (2393070, 2352), (2395422, 692), (2396114, 911), (2397025, 803), (2397828, 889), (2398717, 730)], [(2399447, 48), None, None, (2399495, 42), None, (2399537, 27), (2399564, 43), None, None, None, None, None, None, None, (2399607, 21), None, None, (2399628, 42), None, (2399670, 25), (2399695, 44), None, (2399739, 49), None, None, (2399788, 23), None, None, None, None, None, None, (2399811, 21), (2399832, 46), None, None, (2399878, 44), None, None, None, None, (2399922, 44), (2399966, 21), (2399987, 23), None, None, None, None, (2400010, 42), None, None, None, None, None, (2400052, 31), None, None, None, None, (2400083, 42), (2400125, 19), None, None, (2400144, 21), None, (2400165, 26), (2400191, 56), None, (2400247, 16), (2400263, 42), (2400305, 27), None, None, None, None, (2400332, 21), (2400353, 52), None, (2400405, 17), (2400422, 20), (2400442, 42), None, None, None, (2400484, 25), (2400509, 17), (2400526, 27), (2400553, 21), None, None, None, (2400574, 24), None, (2400598, 24), (2400622, 21), (2400643, 24), None, (2400667, 48), None, None, (2400715, 17), (2400732, 19), None, None, None, None, (2400751, 31), None, None, None, None, None, None, (2400782, 28), None, (2400810, 42), (2400852, 42), (2400894, 17), (2400911, 17), (2400928, 26), None, (2400954, 19), None, None, None, None, (2400973, 20), None, None, (2400993, 42), (2401035, 63), (2401098, 17), None, None, (2401115, 21), None, None, None, None, (2401136, 21), (2401157, 16), None, (2401173, 31), None, None, None, None, (2401204, 42), None, (2401246, 80), None, (2401326, 9), None, (2401335, 21), (2401356, 42), None, (2401398, 18), (2401416, 90), (2401506, 56), (2401562, 45), None, (2401607, 42), None, None, (2401649, 24), (2401673, 21), None, None, None, None, None, (2401694, 42), (2401736, 21), (2401757, 21), None, (2401778, 42), (2401820, 25), None, (2401845, 55), (2401900, 21), (2401921, 42), None, None, (2401963, 36), (2401999, 16), None, None, (2402015, 16), None, (2402031, 35), None, None, (2402066, 21), None, (2402087, 22), (2402109, 21), (2402130, 21), (2402151, 21), None, (2402172, 63), (2402235, 41), (2402276, 21), (2402297, 42), None, None, None, None, None, (2402339, 15), (2402354, 21), (2402375, 21), None, None, (2402396, 21), None, None, (2402417, 21), None, None, (2402438, 19), (2402457, 66), None, None, None, (2402523, 50), None, (2402573, 21), (2402594, 21), (2402615, 19), None, (2402634, 16), (2402650, 26), None, (2402676, 58), (2402734, 42), None, None, None, None, None, None, (2402776, 21), None, None, None, (2402797, 21), None, None, (2402818, 64), None, (2402882, 254), (2403136, 21), (2403157, 24), None, (2403181, 21), (2403202, 29)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2403231, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
